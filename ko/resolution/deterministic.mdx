---
title: "결정론적 결산"
description: "암호화폐 마켓이 자동으로 결산되는 방식"
---
암호화폐 마켓은 시간 가중 평균 가격(TWAP) 계산과 함께 오라클 가격 피드를 사용하여 결산됩니다.
## **인프라**
**기본:** Pyth Network ([링크](https://www.pyth.network/))
**대체:** Switchboard ([링크](https://switchboard.xyz/))
둘 다 암호화폐 자산에 대한 실시간, 암호화 서명된 가격 데이터를 제공합니다.
## TWAP 계산
마켓은 마켓 만료 시 끝나는 15분 시간 가중 평균 가격을 사용하여 결산됩니다.
$$
\text{TWAP} = \sum_{i} (p_i \times t_i) / \sum_{i}t_i
$$
여기서:
- $p_i$는 데이터 포인트 $i$의 가격
- $t_i$는 해당 가격이 활성화된 기간
- 윈도우: 만료 $T$까지 15분
**예시:**
|                 | **값**                                            |
| --------------: | ------------------------------------------------- |
| **마켓**        | "비트코인이 2025년 12월 31일에 150,000달러 이상으로 마감할까요?" |
| **만료**        | 2025년 12월 31일 23:59:59 UTC                     |
| **TWAP 윈도우** | 23:45:00 – 23:59:59 UTC                           |
$\text{TWAP} \ge 150000$이면 → YES 승리
$\text{TWAP} < 150,000$이면 → NO 승리
## 왜 TWAP인가?
단일 타임스탬프 가격은 조작 가능합니다. 15분 평균은 지속적인 가격 움직임이 필요하여 플래시 론 공격이나 짧은 조작을 무효화합니다.
## 다중 피드 보호
$$
\text{최종 가격} = \text{Median}(\text{Pyth 가격}, \text{Switchboard 가격})
$$
$\frac{|\text{Pyth} - \text{Switchboard}|}{\text{Median}} > 2\% $인 경우: → 결산 일시 중지 → 관리자 경고 → 수동 검토
교차 검증으로 단일 오라클 실패를 방지합니다.
## 가격 제한
TWAP 윈도우 동안 분당 최대 1% 가격 변동. 3 표준편차를 초과하는 이상치는 거부됩니다.
## 활성 검사
TWAP 윈도우는 최소 오라클 업데이트 수가 필요합니다 (약 분당 2회 = 15분 윈도우에 30회 업데이트).
**업데이트가 불충분한 경우:**
- 오라클이 다운되었는지 확인
- 예인 경우: 윈도우 연장
- 아니오인 경우: 마켓을 무효로 표시

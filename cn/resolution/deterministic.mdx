---
title: "确定性结算"
description: "加密市场如何自动结算"
---
加密市场使用预言机价格源和时间加权平均价格（TWAP）计算进行结算。
## **基础设施**
**主要：** Pyth Network（[链接](https://www.pyth.network/)）
**备用：** Switchboard（[链接](https://switchboard.xyz/)）
两者都为加密资产提供实时、加密签名的价格数据。
## TWAP 计算
市场使用在市场到期时结束的 15 分钟时间加权平均价格进行结算。
$$
\text{TWAP} = \sum_{i} (p_i \times t_i) / \sum_{i}t_i
$$
其中：
- $p_i$ 是数据点 $i$ 的价格
- $t_i$ 是该价格持续的时长
- 窗口：到期 $T$ 前 15 分钟
**示例：**
|                 | **数值**                                          |
| --------------: | ------------------------------------------------- |
| **市场**        | "比特币会在 2025 年 12 月 31 日收于 150,000 美元以上吗？" |
| **到期**        | 2025 年 12 月 31 日 23:59:59 UTC                  |
| **TWAP 窗口**   | 23:45:00 – 23:59:59 UTC                           |
如果 $\text{TWAP} \ge 150000$ → YES 获胜
如果 $\text{TWAP} < 150,000$ → NO 获胜
## 为什么使用 TWAP？
单一时间戳价格容易被操纵。15 分钟平均需要持续的价格变动，使闪电贷攻击或短暂操纵无效。
## 多源保护
$$
\text{最终价格} = \text{Median}(\text{Pyth 价格}, \text{Switchboard 价格})
$$
如果 $\frac{|\text{Pyth} - \text{Switchboard}|}{\text{Median}} > 2\% $：→ 暂停结算 → 警报管理员 → 人工审核
交叉验证防止单一预言机故障。
## 价格限制
TWAP 窗口期间每分钟最大 1% 的价格变动。超过 3 个标准差的异常值将被拒绝。
## 活性检查
TWAP 窗口需要最少数量的预言机更新（约每分钟 2 次 = 15 分钟窗口 30 次更新）。
**如果更新不足：**
- 检查预言机是否宕机
- 如果是：延长窗口
- 如果否：将市场标记为无效
